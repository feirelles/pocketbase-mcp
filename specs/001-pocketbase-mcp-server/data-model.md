# Data Model: PocketBase MCP Server

**Feature**: 001-pocketbase-mcp-server  
**Date**: 2026-01-15

## Overview

This MCP server doesn't manage its own data storage - it interfaces with external PocketBase instances. This document describes the TypeScript interfaces for tool inputs/outputs and internal state management.

## Core Types

### Configuration

```typescript
interface ServerConfig {
  /** PocketBase instance URL (from POCKETBASE_URL env var) */
  baseUrl: string;
  /** Default output format */
  defaultFormat: 'toml' | 'json';
  /** Default pagination limit */
  defaultLimit: number;
  /** Maximum pagination limit */
  maxLimit: number;
  /** Maximum response size in characters */
  maxResponseSize: number;
}
```

### Authentication State

```typescript
interface AuthState {
  /** Whether currently authenticated */
  isAuthenticated: boolean;
  /** Type of authentication */
  authType: 'admin' | 'user' | null;
  /** Authenticated user/admin info */
  model: {
    id: string;
    email: string;
    [key: string]: unknown;
  } | null;
  /** Token expiration timestamp */
  tokenExpiry: string | null;
}
```

### Record Operations

```typescript
interface RecordListParams {
  /** Collection name */
  collection: string;
  /** Page number (1-indexed) */
  page?: number;
  /** Items per page */
  perPage?: number;
  /** Filter expression (PocketBase syntax) */
  filter?: string;
  /** Sort expression (prefix - for desc) */
  sort?: string;
  /** Fields to return (comma-separated) */
  fields?: string;
  /** Relations to expand (comma-separated) */
  expand?: string;
  /** Output format */
  format?: 'toml' | 'json';
}

interface RecordListResult {
  /** Current page number */
  page: number;
  /** Items per page */
  perPage: number;
  /** Total matching records */
  totalItems: number;
  /** Total pages */
  totalPages: number;
  /** Whether more pages exist */
  hasMore: boolean;
  /** Offset for next page */
  nextOffset?: number;
  /** Record data */
  items: Record<string, unknown>[];
}

interface RecordData {
  /** Record ID (auto-generated on create) */
  id?: string;
  /** Creation timestamp */
  created?: string;
  /** Last update timestamp */
  updated?: string;
  /** Dynamic fields based on collection schema */
  [key: string]: unknown;
}
```

### Collection Schema

```typescript
interface CollectionSchema {
  /** Collection ID */
  id: string;
  /** Collection name */
  name: string;
  /** Collection type */
  type: 'base' | 'auth' | 'view';
  /** Whether system collection */
  system: boolean;
  /** Field definitions */
  fields: FieldDefinition[];
  /** Index definitions */
  indexes: string[];
  /** API rules */
  listRule: string | null;
  viewRule: string | null;
  createRule: string | null;
  updateRule: string | null;
  deleteRule: string | null;
}

interface FieldDefinition {
  /** Field name */
  name: string;
  /** Field type */
  type: 'text' | 'number' | 'bool' | 'email' | 'url' | 'date' | 'select' | 'json' | 'file' | 'relation' | 'editor';
  /** Whether required */
  required: boolean;
  /** Type-specific options */
  options: Record<string, unknown>;
}
```

### Error Response

```typescript
interface ErrorResponse {
  /** Error code for programmatic handling */
  code: ErrorCode;
  /** Human-readable error message */
  message: string;
  /** Actionable suggestion */
  suggestion?: string;
  /** Field-specific validation errors */
  fieldErrors?: Record<string, string>;
}

type ErrorCode =
  | 'CONNECTION_ERROR'
  | 'AUTH_REQUIRED'
  | 'AUTH_FAILED'
  | 'NOT_FOUND'
  | 'VALIDATION_ERROR'
  | 'PERMISSION_DENIED'
  | 'RATE_LIMITED'
  | 'SERVER_ERROR';
```

## State Management

### PocketBase Client Singleton

```typescript
// Single PocketBase instance per MCP server process
let pbClient: PocketBase | null = null;

function getClient(): PocketBase {
  if (!pbClient) {
    const url = process.env.POCKETBASE_URL;
    if (!url) {
      throw new Error('POCKETBASE_URL environment variable required');
    }
    pbClient = new PocketBase(url);
  }
  return pbClient;
}
```

### Auth Store Integration

The PocketBase SDK maintains auth state internally:

```typescript
// Check auth status
const isAdmin = pb.authStore.isAdmin;
const isValid = pb.authStore.isValid;
const model = pb.authStore.model;

// Clear auth
pb.authStore.clear();
```

## Validation Rules

### Collection Names
- Must be alphanumeric with underscores
- Cannot start with underscore (reserved for system)
- 1-100 characters

### Record IDs
- 15-character alphanumeric string
- Auto-generated by PocketBase

### Filter Syntax
- PocketBase filter expressions
- Examples: `status = "published"`, `created >= "2024-01-01"`

### Pagination Limits
- Default: 50 items
- Minimum: 1 item
- Maximum: 500 items
